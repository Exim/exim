# sqlite lookups
exim -d-all+lookup -be
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{select name from them where id='userx';}}
${lookup sqlite{DIR/aux-fixed/sqlitedb select name from them where id='userx';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{ select name from them where id='userx';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{ select name from them where id='userx';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{ select name from them where id='xxxx';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{select name from them where id='nothing';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{select id,name from them where id='nothing';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb {select * from them where id='quote2';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{select * from them where id='newline';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{select * from them where id='tab';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{select * from them where id='its';}}
${lookup sqlite,file=DIR/aux-fixed/sqlitedb{select * from them where name='${quote_sqlite:it's}';}}
****
exim -d -DOPT=y -bh 10.0.0.0
helo test
mail from:<a@b>
rcpt to:<c@d>
rcpt to:<c@d>
quit
****
exim -d -bh 10.0.0.0
helo test
mail from:<a@b>
rcpt to:<c@d>
rcpt to:<c@d>
quit
****
exim -d -bh 10.10.10.10
helo test
mail from:<a@b>
rcpt to:<c@d>
rcpt to:<c@d>
quit
****
exim -DOPT=y -odi -d userx
Test message
.
****
exim -d-all+lookup -be
${lookup sqlite{DIR/aux-fixed/sqlitedb select name from them where id='userx';}}
****
#
#
exim -DDATA=DIR/aux-fixed/sqlitedb -d-all+lookup -be
${lookup sqlite{select name from them where id='userx';}}
****
exim -DDATA=nonabsolute_filename -d-all+lookup -be
${lookup sqlite{select name from them where id='userx';}}
****
exim -DDATA=DIR/missingfile -d-all+lookup -be
${lookup sqlite{select name from them where id='userx';}}
****
#
#
mkdir -p tmp
# All these SQL statements return no data, so are "fail" for ${lookup }.
# Enforcement of quoting is not yet enabled (cf. search.c 630) so only
# a paniclog results on violation.
exim -DDATA=DIR/tmp/newdb.sqlite -d-all+expand+lookup -f tainted_username@needsquote.dom -be
${lookup sqlite{create table tb (key text, data1 text, data2 text);} {}{A}}
${lookup sqlite{insert into tb (key, data1, data1) values ('k1', 'plain data', '${quote_sqlite:needs a ' quoted}');} {}{B}}
${lookup sqlite{insert into tb (key, data1, data1) values ('$sender_address', 'should NOT work', 'foo');} {}{C}}
${lookup sqlite{insert into tb (key, data1, data1) values ('${quote_sqlite:$sender_address}', 'should work', 'bar');} {}{D}}
****
perl
system("sqlite3 DIR/tmp/newdb.sqlite .dump");
****
sudo rm -fr tmp
