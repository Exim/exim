# DKIM verify, errors
#
exim -DSERVER=server -bd -oX PORT_D
****
#
# This should fail verify (missing header hash in sig header)
#  - sha1, 1024b
# Mail original in aux-fixed/4500.msg1.txt
# Sig generated by: perl aux-fixed/dkim/sign.pl --method=simple/simple < aux-fixed/4500.msg1.txt
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=rsa-sha1; c=simple/simple; d=test.ex; h=from:to
	:date:message-id:subject; s=sel; bh=OB9dZVu7+5/ufs3TH9leIcEpXSo=;
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test

This is a simple test.
.
??? 250
QUIT
??? 221
****
#
#
# This should fail verify (missing body hash in sig header)
#  - sha1, 1024b
# Mail original in aux-fixed/4500.msg1.txt
# Sig generated by: perl aux-fixed/dkim/sign.pl --method=simple/simple < aux-fixed/4500.msg1.txt
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=rsa-sha1; c=simple/simple; d=test.ex; h=from:to
	:date:message-id:subject; s=sel; b=
	PeUA8iBGfStWv+9/BBKkvCEYj/AVMl4e9k+AqWOXKyuEUfHxqAnV+sPnOejpmvT8
	41kuM4u0bICvK371YvB/yO61vtliRhyqU76Y2e55p2uvMADb3UyDhLyzpco4+yBo
	1w0AuIxu0VU4TK8UmOLyCw/1hxrh1DcEInbEMEKJ7kI=
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test

This is a simple test.
.
??? 250
QUIT
??? 221
****
#
#
# This should fail verify (missing body)
#  - sha1, 1024b
# Mail original in aux-fixed/4500.msg1.txt
# Sig generated by: perl aux-fixed/dkim/sign.pl --method=simple/simple < aux-fixed/4500.msg1.txt
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=rsa-sha1; c=simple/simple; d=test.ex; h=from:to
	:date:message-id:subject; s=sel; bh=OB9dZVu7+5/ufs3TH9leIcEpXSo=; b=
	PeUA8iBGfStWv+9/BBKkvCEYj/AVMl4e9k+AqWOXKyuEUfHxqAnV+sPnOejpmvT8
	41kuM4u0bICvK371YvB/yO61vtliRhyqU76Y2e55p2uvMADb3UyDhLyzpco4+yBo
	1w0AuIxu0VU4TK8UmOLyCw/1hxrh1DcEInbEMEKJ7kI=
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test
.
??? 250
QUIT
??? 221
****
#
#
#
# This should refuse to do verification (over-long body line)
# The sig is bogus, but we don't verify it
write test-data 1x16386
++++
****
#
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=rsa-sha1; c=simple/simple; d=test.ex; h=from:to
	:date:message-id:subject; s=sel; bh=OB9dZVu7+5/ufs3TH9leIcEpXSo=; b=
	PeUA8iBGfStWv+9/BBKkvCEYj/AVMl4e9k+AqWOXKyuEUfHxqAnV+sPnOejpmvT8
	41kuM4u0bICvK371YvB/yO61vtliRhyqU76Y2e55p2uvMADb3UyDhLyzpco4+yBo
	1w0AuIxu0VU4TK8UmOLyCw/1hxrh1DcEInbEMEKJ7kI=
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test

<<< test-data
another data line
.
??? 250
QUIT
??? 221
****
#
#
# This should fail as the sig on the mail uses sha1 but the dns record requires sha256
#
#  - sha256, 512b
# Mail original in aux-fixed/4500.msg1.txt
# Sig generated by: perl aux-fixed/dkim/sign.pl --keyfile=aux-fixed/dkim/dkim512.private \
#                       --method=simple/simple --selector=ses_sha1 < aux-fixed/4500.msg1.txt
# and then modifying the s= manually
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=rsa-sha1; c=simple/simple; d=test.ex; h=from:to
	:date:message-id:subject; s=ses_sha256; bh=OB9dZVu7+5/ufs3TH9leIcE
	pXSo=; b=hG14R3Eb/f13Pw6J0LmovHAL01KHVmVrTZ7KJrqieYTQemUaseoU2pB
	7/g8NUwG/AsYoaw3gaAK8PqxSk2lcIQ==
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test

This is a simple test.
.
??? 250
QUIT
??? 221
****
killdaemon
#
#
# See what happens when we do a DNS lookup from the DKIM ACL
exim -DSERVER=server -DBAD=bad -bd -oX PORT_D
****
# This should fail verify (missing header hash in sig header)
#  - sha1, 1024b
# Mail original in aux-fixed/4500.msg1.txt
# Sig generated by: perl aux-fixed/dkim/sign.pl --method=simple/simple < aux-fixed/4500.msg1.txt
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=rsa-sha1; c=simple/simple; d=test.ex; h=from:to
	:date:message-id:subject; s=sel; bh=OB9dZVu7+5/ufs3TH9leIcEpXSo=;
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test

This is a simple test.
.
??? 250
QUIT
??? 221
****
#
#
killdaemon
#
#
# A deny return from the dkim ACL should reject the message
exim -DSERVER=server -DSTRICT=y -bd -oX PORT_D
****
# This should fail verify (missing header hash in sig header)
#  - sha1, 1024b
# Mail original in aux-fixed/4500.msg1.txt
# Sig generated by: perl aux-fixed/dkim/sign.pl --method=simple/simple < aux-fixed/4500.msg1.txt
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<shouldfail@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=rsa-sha1; c=simple/simple; d=test.ex; h=from:to
	:date:message-id:subject; s=sel; bh=OB9dZVu7+5/ufs3TH9leIcEpXSo=;
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test

This is a simple test.
.
??? 550
QUIT
??? 221
****
#
#
killdaemon
no_stdout_check
no_msglog_check
