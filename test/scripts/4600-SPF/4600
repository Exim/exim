# acl condition and variables
#
# The 127.0.0.1 source addr seems to be a builtin in the libspf2 library;
# no dns lookup is done.  So we run a separate testcase for that.
# HOSTIPV4 does get a series of lookups (see server debug output to verify that)
#
# The libspf2 object stack is built with an exim-specific DNS lookup base
# object, so the testsuite intercept to fakedns works.
# Be careful of names and addresses used, as nonhandled lookups are passed on
# to real DNS.
#
exim -bd -DSERVER=server -oX PORT_S:PORT_D2
****
#
# no dns record - should get "none"
client HOSTIPV4 PORT_S
??? 220
helo testclient
??? 250
mail from:<b@test.example.com>
??? 250
rcpt to:<fred@test.ex>
??? 250
quit
****
#
# "fail"
client HOSTIPV4 PORT_S
??? 220
helo testclient
??? 250
mail from:<failme@example.com>
??? 250
rcpt to:<fred@test.ex>
??? 550
quit
****
#
# "pass"
client HOSTIPV4 PORT_S
??? 220
helo testclient
??? 250
mail from:<a@passme.example.com>
??? 250
rcpt to:<fred@test.ex>
??? 250
quit
****
#
#
# "neutral"
client HOSTIPV4 PORT_S
??? 220
helo testclient
??? 250
mail from:<a@neutral.example.com>
??? 250
rcpt to:<fred@test.ex>
??? 250
quit
****
#
#
# "softfail"
client HOSTIPV4 PORT_S
??? 220
helo testclient
??? 250
mail from:<a@softfail.example.com>
??? 250
rcpt to:<fred@test.ex>
??? 250
quit
****
#
#XXX we need testcases for the other results
#
#
#
# helo name gets used when mailfrom is null
client HOSTIPV4 PORT_S
??? 220
helo passme.helo.example.com
??? 250
mail from:<>
??? 250
rcpt to:<fred@test.ex>
??? 250
quit
****
#
# a nonempty mailfrom takes precedence over the helo
client HOSTIPV4 PORT_S
??? 220
helo passme.helo.example.com
??? 250
mail from:<failme@example.com>
??? 250
rcpt to:<fred@test.ex>
??? 550
quit
****
#
killdaemon
