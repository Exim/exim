# ATRN
exim -bd -DSERVER=server -oX PORT_D:PORT_D2
****
#
# Should not advertise on "normal" SMTP port,
# end should reject an attempt
client 127.0.0.1 PORT_D
??? 220
EHLO tester
??? 250-
??? 250-SIZE
??? 250-LIMITS
??? 250-8BITMIME
??? 250-PIPELINING
??? 250-AUTH
??? 250 HELP
ATRN #notadvertised
??? 502
QUIT
??? 221
???*
****
# should reject when not authenticated
# also when authed, but tried within a mail transaction
# also when the ACL says deny (based on src ip)
client 127.0.0.1 PORT_D2
??? 220
EHLO tester
??? 250-
??? 250-SIZE
??? 250-LIMITS
??? 250-8BITMIME
??? 250-ATRN
??? 250-PIPELINING
??? 250-AUTH
??? 250 HELP
ATRN #notauth
??? 530
AUTH PLAIN AHVzZXJ4AHNlY3JldA==
??? 235
MAIL FROM:<fred@example.com>
??? 250
ATRN #inmail
??? 503
RSET
??? 250
ATRN #failacl
??? 450
****
#
#
# setup a queued message, then probe for it
client HOSTIPV4 PORT_D2
??? 220
EHLO tester
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-ATRN
??? 250-
??? 250-AUTH
??? 250 HELP
MAIL FROM:<fred@example.com>
??? 250
RCPT TO:<bill@clientdom.net>
??? 250
DATA
??? 354
Subject: queued msg

Body data is a single line.
.
??? 250
AUTH PLAIN AHVzZXJ4AHNlY3JldA==
??? 235
ATRN
??? 250
220 ODMR client now in reversed state
??? EHLO
250-hello, mate
250 HELP
??? MAIL
250 saw your MAIL cmd
??? RCPT
250 saw your RCPT cmd
??? DATA
354 go ahead
??? Received:
??? \x09by
??? \x09(
??? \x09id
??? \x09for
??? \x09
??? Subject: queued msg
??? 
??? Body
??? .
250 ODMR client: message accepted
??? QUIT
221 bye
???*
****
#
#
# A mixture of spooled messages
exim a@otherdomain.net
Subject: should not look at this one
****
exim b@clientdom.net c@elsewhere.net d@clientdom.net
Subject: only b & d should be delivered
****
exim e@clientdom.net
Subject: should be delivered
****
client HOSTIPV4 PORT_D2
??? 220
EHLO tester
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-ATRN
??? 250-
??? 250-AUTH
??? 250 HELP
AUTH PLAIN AHVzZXJ4AHNlY3JldA==
??? 235
ATRN
??? 250
220 ODMR client now in reversed state
??? EHLO
250-hello, mate
250-PIPELINING
250 HELP
??? MAIL
250 saw your MAIL cmd
??? RCPT TO:<b
250 saw your RCPT cmd for b
??? RCPT TO:<d
250 saw your RCPT cmd for d
??? DATA
354 go ahead
??? Received:
??? \x09(
??? \x09id
??? \x09
??? Subject: only b & d should be delivered
??? Message-Id:
??? From:
??? Date:
??? 
??? .
250 ODMR client: message accepted
??? MAIL
250 saw your MAIL cmd
??? RCPT TO:<e
250 saw your RCPT cmd for e
??? DATA
354 go ahead
??? Received:
??? \x09(
??? \x09id
??? \x09for
??? \x09
??? Subject: should be delivered
??? Message-Id:
??? From:
??? Date:
??? 
??? .
250 ODMR client: message accepted
??? QUIT
221 bye
****
millisleep 500
#
#
# client requests specific domain; ok
# then tries again; tmp-reject since nothing waiting
exim f@cl2dom.net
Subject: should be delivered
****
client HOSTIPV4 PORT_D2
??? 220
EHLO tester
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-ATRN
??? 250-
??? 250-AUTH
??? 250 HELP
AUTH PLAIN AHVzZXJ4AHNlY3JldA==
??? 235
ATRN cl2dom.net
??? 250
220 ODMR client now in reversed state
??? EHLO
250-hello, mate
250 HELP
??? MAIL
250 saw your MAIL cmd
??? RCPT TO:<f
250 saw your RCPT cmd for f
??? DATA
354 go ahead
??? Received:
??? \x09(
??? \x09id
??? \x09for
??? \x09
??? Subject: should be delivered
??? Message-Id:
??? From:
??? Date:
??? 
??? .
250 ODMR client: message accepted
??? QUIT
221 bye
****
sleep 1
exim -bp
****
client HOSTIPV4 PORT_D2
??? 220
EHLO tester
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-ATRN
??? 250-
??? 250-AUTH
??? 250 HELP
AUTH PLAIN AHVzZXJ4AHNlY3JldA==
??? 235
ATRN cl2dom.net
??? 453
QUIT
??? 221
****
killdaemon
#
exim -bd -DSERVER=server -DQDG=altqueue -oX PORT_D:PORT_D2
****
exim -MCG altqueue g@clientdom.net
Subject: should be delivered
****
client HOSTIPV4 PORT_D2
??? 220
EHLO tester
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-ATRN
??? 250-
??? 250-AUTH
??? 250 HELP
AUTH PLAIN AHVzZXJ4AHNlY3JldA==
??? 235
ATRN
??? 250
220 ODMR client now in reversed state
??? EHLO
250-hello, mate
250 HELP
??? MAIL
250 saw your MAIL cmd
??? RCPT TO:<g
250 saw your RCPT cmd for g
??? DATA
354 go ahead
??? Received:
??? \x09(
??? \x09id
??? \x09for
??? \x09
??? Subject: should be delivered
??? Message-Id:
??? From:
??? Date:
??? 
??? .
250 ODMR client: message accepted
??? QUIT
221 bye
****
#
killdaemon
no_msglog_check
