# PRDR (Per-Recipient Data Responses) server
need_ipv4
no_msglog_check
#
# 1: userx should be accepted, y should be tmp-rejected,
#    z rejected, all after data per PRDR spec
exim -DSERVER=server -bd -oX PORT_D
****
client 127.0.0.1 PORT_D
??? 220
ehlo rhu.barb
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-PRDR
??? 250
mail from:<> PRDR
??? 250
rcpt to:<userx@test.ex>
??? 250
rcpt to:<usery@test.ex>
??? 250
rcpt to:<userz@test.ex>
??? 250
data
??? 354
Sender: sender@some.where
.
??? 353
??? 250
??? 450
??? 550
??? 250
quit
??? 221
****
millisleep 500
#
#
# 2: traditional data acl should be called, resulting in an overall reject
client 127.0.0.1 PORT_D
??? 220
ehlo rhu.barb
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-PRDR
??? 250
mail from:<> PRDR
??? 250
rcpt to:<userp@test.ex>
??? 250
rcpt to:<userq@test.ex>
??? 250
data
??? 354
Sender: sender@some.where
.
??? 353
??? 250
??? 250
??? 550
quit
??? 221
****
millisleep 500
#
#
# 3: PRDR should be avoided for a single-recipient message
# even though the client showed support.
client 127.0.0.1 PORT_D
??? 220
ehlo rhu.barb
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-PRDR
??? 250
mail from:<> PRDR
??? 250
rcpt to:<user1@test.ex>
??? 250
data
??? 354
Sender: sender@some.where
.
??? 250
quit
??? 221
****
millisleep 500
#
# 4: double temp-reject
client 127.0.0.1 PORT_D
??? 220
ehlo rhu.barb
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-PRDR
??? 250
mail from:<> PRDR
??? 250
rcpt to:<usery@test.ex>
??? 250
rcpt to:<usery@test.ex>
??? 250
data
??? 354
Sender: sender@some.where
.
??? 353
??? 450
??? 450
??? 250
quit
??? 221
****
millisleep 500
#
# 5: double reject
client 127.0.0.1 PORT_D
??? 220
ehlo rhu.barb
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-PRDR
??? 250
mail from:<> PRDR
??? 250
rcpt to:<userz@test.ex>
??? 250
rcpt to:<userz@test.ex>
??? 250
data
??? 354
Sender: sender@some.where
.
??? 353
??? 550
??? 550
??? 550
quit
??? 221
****
millisleep 500
#
# 6: no PRDR request
client 127.0.0.1 PORT_D
??? 220
ehlo rhu.barb
??? 250-
??? 250-
??? 250-
??? 250-
??? 250-PRDR
??? 250
mail from:<>
??? 250
rcpt to:<userx@test.ex>
??? 250
data
??? 354
Sender: sender@some.where
.
??? 250
quit
??? 221
****
millisleep 500
#
killdaemon
#
